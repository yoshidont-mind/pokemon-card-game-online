# Phase 04 UIフィードバック解釈・修正方針整理

作成日: 2026-02-19（JST）
対象: `pokemon-card-game-online`
関連フェーズ: Phase 04（DnD基盤）
ステータス: Draft（実装前の合意形成用）

---

## 1. このドキュメントの目的

本ドキュメントは、ユーザーから受領した UI/UX フィードバックを

1. 具体的な挙動として正確に解釈する
2. 原因を技術的に分解する
3. 修正方針を実装可能なレベルで定義する
4. 曖昧点を明示して事前確認する

ための設計メモである。

---

## 2. 受領フィードバックの要約

受領した指摘は以下6系統に整理できる。

- F-01: 手札プレビュー領域（点線枠）が大きすぎる
- F-02: ホバー拡大カードの重なり順（Z軸）が不適切で文言が読めない
- F-03: 手札エリア展開時にベンチを隠し、誤ドロップを誘発する
- F-04: 画面縦サイズ変更時に手札カードが下にずれて見切れる
- F-05: ドラッグ中の二重表示（ゴースト）が不自然で一貫性がない
- F-06: 小道具BOX内の gap が広すぎる

---

## 3. 項目別の解釈と修正方針

## F-01 手札プレビュー領域が大きすぎる

### ユーザー意図の解釈

- 「カードを読むための拡大」は必要。
- ただし、拡大表示のために常時大きい空き領域を占有する UI は不要。
- 可能なら、別枠プレビューより「元カードそのものがその場で拡大」される体験が望ましい。

### 現象の原因仮説

- 現状は `handTrayPanel` 内に「固定高さのプレビュー領域」を確保している。
- そのため、カード未選択でも点線の空領域が大きく残る。

### 修正方針

- 常時表示のプレビュー領域を削除し、**インライン拡大方式**に変更する。
- 拡大対象カードのみ `transform: scale(...)` + 高い `z-index` を与える。
- クリック固定（ピン留め）は維持するが、表示場所は手札列内に統一する。

### 実装方針（案）

- `HandTray` から `handPreviewArea` ブロックを削除。
- `handCardButtonActive` / `:hover` で `z-index` を引き上げる。
- 必要なら `overflow: visible` を hand row に適用し、拡大部分が見切れないようにする。

---

## F-02 拡大カードが他カードより下に出て読めない

### ユーザー意図の解釈

- ホバー/クリックで拡大したカードは、必ず最前面で読めるべき。

### 現象の原因仮説

- 拡大演出はあるが、`z-index` の優先順位が未調整。
- 兄弟要素の stacking context の関係で、後続要素に隠れる。

### 修正方針

- 拡大対象のカードコンテナに `position: relative` + 高 `z-index` を付与。
- 非アクティブカードは低 z-index を固定。
- overlay使用時も拡大カードの可読性を優先。

### 実装方針（案）

- `handCardDraggable` / `handCardButtonActive` に `z-index` ルール追加。
- `draggingSource` の opacity を見直し、読解性を阻害しない強度へ調整。

---

## F-03 手札エリアがベンチを隠し、誤ドロップする

### ユーザー意図の解釈

- 手札を開いた状態でも、ベンチへの操作はしやすくあるべき。
- 手札の直下にある見えないベンチに誤ドロップされる挙動は避けたい。

### 現象の原因仮説

- 手札パネルの占有高さが大きく、盤面を覆っている。
- DnD判定が `closestCenter` のため、ユーザー視界外の候補へ吸着する場合がある。

### 修正方針

- 手札パネルの高さを縮小し、デフォルト占有面積を減らす。
- **手札パネルに隠れている領域はドロップ不可**とするガードを導入。
- 誤ドロップを防ぐため、drop確定前に「可視ターゲットか」を判定する。

### 実装方針（案）

- `handTrayPanel` の `max-height` を縮小（例: `min(28vh, ...)`）。
- `useBoardDnd` で `onDragEnd` 時に以下を追加:
  - ドロップ座標の最前面要素を `elementFromPoint` で取得
  - 手札パネル配下の場合、盤面ゾーンへの確定を reject
- 併せて、手札開閉トグル初期状態を必要に応じて `closed` に寄せる（運用選択）。

### 備考

- 「手札トレイ自体をドラッグ移動可能にする」案は有効だが、Phase 04 のスコープを拡大するため、
  現時点では **優先度を一段下げる**（まずは誤ドロップ防止を先行）。

---

## F-04 画面縦サイズ変更で手札カードが下にずれて見切れる

### ユーザー意図の解釈

- リサイズしても手札カードが手札枠内に安定表示されるべき。

### 現象の原因仮説

- `fixed` 配置 + panel内の高さ/overflow設定が競合。
- プレビュー領域の高さ確保が縮小時レイアウトを圧迫している。

### 修正方針

- F-01 の「プレビュー領域削除」により縦方向レイアウトを単純化。
- `handCards` の縦位置を固定し、`align-items`, `padding`, `overflow` を再調整。

### 実装方針（案）

- `handTrayPanel` を1段レイアウト化（カード列のみ）。
- `handCards` の `padding-bottom`/`max-height` を再設計。
- 1366x768 / 1920x1080 / 縦方向拡大の手動確認ケースを追加。

---

## F-05 ドラッグ中の二重表示（ゴースト）が不自然

### ユーザー意図の解釈

- ドラッグ中の視覚表現はシンプルで一貫していてほしい。
- 現状の「元カード + ずれた半透明複製」は不自然。

### 現象の原因仮説

- `@dnd-kit` の `DragOverlay` と、元要素側の `transform/opacity` 演出が重複。
- 手札だけ別演出になっており一貫性がない。

### 修正方針

- ドラッグ中の表示を一本化する。
- 原則: **Overlayのみ表示** か **元要素のみ表示** のどちらかに統一。

### 実装方針（推奨）

- 推奨: Overlayのみ強調（元要素は `opacity: 0` 近傍にして存在感を消す）。
- もしくは逆に Overlayを切り、元要素追従のみへ統一（要件次第）。

---

## F-06 小道具BOX内の gap が大きい

### ユーザー意図の解釈

- 小道具は密度高く並び、ひと目で取りやすい方がよい。

### 現象の原因仮説

- `toolboxGrid` の `gap` と `button` 内余白が、現在の幅に対して大きい。

### 修正方針

- gap と内側 padding を段階的に縮小。
- クリックターゲット（最小 32px 以上）は維持。

### 実装方針（案）

- `toolboxGrid gap: 6px -> 4px` 程度
- `toolboxItem padding/min-height` を微調整
- 結果を手動確認し、過密すぎる場合のみ再拡張

---

## 4. 修正実装の優先順（提案）

1. F-01/F-02/F-04 を同時対応（手札UIの構造整理）
2. F-03 の誤ドロップ防止ガード導入
3. F-05 のドラッグ表示統一
4. F-06 のgap調整

理由:
- まず「読める/見える/置ける」の根本UXを回復する。
- 次に誤操作（意図しない確定）を防ぐ。
- 最後に視覚微調整で仕上げる。

---

## 5. 受け入れ判定（この修正のDone条件）

- 手札パネル展開時に大きな空プレビュー領域が表示されない
- 拡大中のカードが常に最前面で可読
- 手札パネル上の操作で、隠れたベンチへ誤ドロップしない
- 縦方向リサイズでも手札カードが見切れない
- ドラッグ中の視覚表現が1種類に統一され、不自然な二重表示がない
- 小道具BOXのgapが適正化され、密度と押しやすさが両立

---

## 6. 実装前に確認したい点（質問）

以下は仕様として選択が必要なため、実装前に確認したい。

### Q1 手札拡大方式

- A. インライン拡大（推奨）
  - 内容: そのカード自身をその場で拡大。別枠プレビューは廃止。
  - メリット: 空き領域が消え、紙の操作感に近い。
  - デメリット: 手札が多いと重なり調整が必要。

- B. 別枠プレビュー維持（縮小のみ）
  - メリット: 常に大きく表示できる。
  - デメリット: 盤面占有が残る。

### Q2 誤ドロップ対策の方式

- A. 手札パネルの被覆領域をドロップ不可にする（推奨）
  - 内容: 手札パネル上でドロップした場合は盤面確定させない。
  - メリット: 誤ドロップを直接防げる。
  - デメリット: 判定ロジックが少し増える。

- B. 手札トレイ自体を移動可能にする
  - メリット: ユーザーが邪魔な位置から避けられる。
  - デメリット: Phase 04の実装範囲が増え、検証コストも増える。

### Q3 ドラッグ中の見た目

- A. Overlayのみ見せる（推奨）
  - メリット: 二重表示が解消し、表示が一貫する。
  - デメリット: 元カードが一時的に見えなくなる。

- B. 元カードのみ追従（Overlayなし）
  - メリット: DOMがシンプル。
  - デメリット: 場合によって追従感が弱く見える。

---

## 7. 推奨方針（現時点）

- Q1: A（インライン拡大）
- Q2: A（手札被覆領域をドロップ不可）
- Q3: A（Overlayのみ表示）

推奨理由:
- UX課題を最小の変更で直接解決できる。
- DnD基盤（Phase 04）の責務範囲に収まり、Phase 05以降へ影響を広げにくい。

