# Codex 運用ルール（本リポジトリ共通）

この `AGENTS.md` は、Codex（AI エージェント）が本リポジトリで作業する際の安全ガードレールです。  
以降の全てのチャット/セッションで、コマンド実行時は必ずこのルールに従ってください。

---

## 重要（秘匿情報・個人情報の取り扱い）

- `.env` / `.env.local` / `*.key` / 秘密鍵 / アクセストークン / サービスアカウントJSONは、コミット禁止・画面共有貼付禁止・議事録コピペ禁止。
- Firebase の機密情報（管理用資格情報、認証情報、内部URL、個人情報を含むエクスポートデータ）を、リポジトリ内に平文保存しない。
- シークレットは、原則として Firebase / GCP の安全な保管機構（例: Secret Manager）を使い、コード直書きしない。

---

## 絶対に行わない（禁止）

### 1) リモートリポジトリに不可逆な影響を与える破壊的動作

例（ただしこれに限らない）:
- `git push --force` / 履歴改変を伴う強制上書き
- リモートブランチ削除
- リポジトリ設定の破壊的変更

### 2) Firestore / Firebase Database の破壊的操作

例（ただしこれに限らない）:
- データベース削除
- コレクション全削除や大量削除
- 復旧不能なデータ破壊

### 3) Firebase / GCP の破壊的な基盤変更

例（ただしこれに限らない）:
- Firebase プロジェクト削除
- Hosting サイト/チャネルの削除
- 認証基盤（Auth 設定やプロバイダ）の破壊的削除

---

## 必ず「目的と必要性を説明しながら」許可を求める（事前承認が必須）

### 1) リモートリポジトリに影響する操作

例（ただしこれに限らない）:
- `git push`
- PR 作成/更新
- リモート設定変更

### 2) Firestore / Firebase のデータ・設定を変更する操作

例（ただしこれに限らない）:
- Firestore の `CREATE` / `UPDATE` / `DELETE`
- Security Rules / Indexes / Authentication / Hosting / Functions の変更・デプロイ
- 本番・検証環境データの書き換え

### 3) バージョン管理されていないファイルや、リポジトリ外へ影響する操作

例（ただしこれに限らない）:
- `.env*` や秘密情報ファイルの作成・編集・削除
- プロジェクトディレクトリ外へのファイル作成・編集・削除

### 4) 課金や運用影響が発生しうる外部操作

例（ただしこれに限らない）:
- Firebase/GCP の有料機能有効化
- 長時間ジョブの実行・スケジュール設定変更

---

## 事前承認不要（いちいち許可を求めない）

### 1) バージョン管理されているファイルへのローカル変更

例:
- 既存コード修正
- ドキュメント更新
- テストコード追加

### 2) ローカル検証コマンド

例:
- `npm ci`, `npm start`, `npm test`, `npm run build`
- 静的解析、ユニットテスト、ローカル動作確認

### 3) 読み取り目的のネットワークアクセス

例:
- 公式ドキュメント調査
- 実装確認のための公開情報取得

### 4) Firebase / Firestore の読み取り確認

例:
- 設定内容の閲覧
- エラーログ確認
- 読み取り専用のデータ確認

---

## Git運用（main直push禁止：原則）

複数タスク並列での開発を前提に、`main` への直接 push を禁止します。

作業フロー:
1. 作業ブランチを作成
2. 変更・コミット
3. リモートへ push
4. PR を作成
5. レビュー後に merge

補足:
- `main` 直push禁止は、GitHub 側の branch protection でも強制することを推奨します。

